# File Management API

Надёжный Node.js/Express-сервер для загрузки, скачивания, удаления и инспекции файлов в пределах текущего проекта.

## Запуск локально

```bash
npm install
npm start
```

По умолчанию сервер слушает порт `8000`. Изменить порт можно через переменную окружения `PORT`.

## Docker

```bash
docker build -t project-file-api .
docker run --rm -p 8000:8000 project-file-api
```

## Маршруты

### `GET /`
Простой health-check с перечислением доступных эндпоинтов.

### `GET /download`
Архивирует и отдаёт весь проект в формате ZIP. Дополнительно поддерживает параметр `path`:

- `path` — относительный путь к файлу/директории, которые нужно архивировать. По умолчанию архивируется весь проект.

### `GET /api/download`
Идентичный `/download`, добавлен для удобства использования API.

### `POST /api/upload`
Загружает файл в проект.

Параметры запроса:

- `file` (обязательный, form-data) — загружаемый файл.
- `destination` (необязательный, form-data или query) — относительный путь директории внутри проекта, куда нужно поместить файл/распаковать архив. По умолчанию — корень проекта.
- `extract` (необязательный, form-data или query) — укажите `true`, чтобы автоматически распаковать загруженный ZIP-архив, удалить исходный ZIP и сохранить его содержимое в `destination`.

Ответы:

- `200 Uploaded` — файл загружен. Возвращает путь, по которому сохранён файл.
- `200 Extracted` — архив распакован. Возвращает список извлечённых файлов/директорий.
- `400` — некорректные параметры или попытка использовать `extract` не для ZIP-архива.

### `GET /api/tree`
Возвращает JSON-дерево проекта (исключая `.git` и `node_modules`).

Пример ответа:

```json
{
  "name": "github",
  "path": ".",
  "type": "directory",
  "children": [
    { "name": "src", "path": "src", "type": "directory", "children": [] },
    { "name": "package.json", "path": "package.json", "type": "file" }
  ]
}
```

### `DELETE /api/delete`
Удаляет файл или директорию.

Тело запроса (JSON):

```json
{
  "targetPath": "relative/path/to/file-or-directory"
}
```

Ограничения:

- Нельзя удалять файлы/папки вне проекта.
- Нельзя удалить корневую директорию проекта.

Ответ `200` содержит тип удалённого объекта и его относительный путь.

## Проверка API через curl

```bash
# Дерево проекта
curl http://localhost:8000/api/tree | jq

# Загрузка файла
curl -F "file=@README.md" -F "destination=uploads" http://localhost:8000/api/upload

# Загрузка и распаковка ZIP-архива
curl -F "file=@archive.zip" "http://localhost:8000/api/upload?extract=true"

# Скачивание проекта
curl -OJ http://localhost:8000/download

# Удаление файла
curl -X DELETE -H "Content-Type: application/json" \
  -d '{"targetPath":"uploads/README.md"}' \
  http://localhost:8000/api/delete
```

## Замечания по безопасности

- Все операции происходят строго в пределах корня проекта.
- Архивы проверяются на наличие попыток выйти за пределы целевой директории.
- Символические ссылки игнорируются при построении дерева.
